<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Последний сеанс - 2023/2024</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #050505;
            color: #d1d1d1;
            overflow-x: hidden;
            scroll-behavior: smooth;
            transition: background-color 0.2s;
        }
        .cinematic-bg {
            background: radial-gradient(circle at center, #1a1a2e 0%, #050505 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* Анимация снега */
        .snow-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }
        .snowflake {
            position: absolute;
            background: white;
            border-radius: 50%;
            opacity: 0.3;
            animation: fall linear infinite;
        }
        @keyframes fall {
            to { transform: translateY(100vh) translateX(20px); }
        }

        .message {
            max-width: 85%;
            margin-bottom: 1.5rem;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.4s ease-out;
            z-index: 10;
        }
        .message.show {
            opacity: 1;
            transform: translateY(0);
        }
        .bubble {
            padding: 12px 16px;
            border-radius: 18px;
            position: relative;
            font-size: 0.95rem;
            line-height: 1.4;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        .msg-left .bubble {
            background: #1f1f27;
            border: 1px solid #333;
            border-bottom-left-radius: 4px;
            color: #e0e0e0;
        }
        .msg-right .bubble {
            background: #7c2d12;
            border-bottom-right-radius: 4px;
            color: #ffffff;
        }
        .typing {
            font-size: 0.8rem;
            color: #6b7280;
            margin-bottom: 1rem;
            display: none;
            font-style: italic;
        }
        .system-msg {
            font-style: italic;
            color: #6b7280;
            text-align: center;
            font-size: 0.85rem;
            margin: 2rem 0;
            padding: 0 2rem;
            line-height: 1.5;
            transition: all 0.3s;
        }

        /* Глобальный Глюк */
        .global-glitch {
            animation: screen-shake 0.3s infinite;
            filter: contrast(150%) brightness(120%) saturate(200%);
        }
        @keyframes screen-shake {
            0% { transform: translate(0,0); }
            20% { transform: translate(-5px, 5px) skewX(2deg); }
            40% { transform: translate(5px, -5px) rotate(1deg); }
            60% { transform: translate(-5px, -5px) skewY(2deg); }
            80% { transform: translate(5px, 5px) scale(1.02); }
            100% { transform: translate(0,0); }
        }

        .glitch-text {
            animation: glitch-color 0.2s infinite;
            color: #ff4d4d;
            font-weight: bold;
        }
        @keyframes glitch-color {
            0% { color: #ff0000; text-shadow: 2px 0 blue; }
            50% { color: #ffffff; text-shadow: -2px 0 red; }
            100% { color: #ff0000; text-shadow: 2px 0 green; }
        }

        .dot {
            display: inline-block;
            width: 4px;
            height: 4px;
            background: #6b7280;
            border-radius: 50%;
            margin-right: 2px;
            animation: dot-pulse 1.4s infinite;
        }
        .dot:nth-child(2) { animation-delay: 0.2s; }
        .dot:nth-child(3) { animation-delay: 0.4s; }
        @keyframes dot-pulse {
            0%, 100% { opacity: 0.3; transform: translateY(0); }
            50% { opacity: 1; transform: translateY(-3px); }
        }
    </style>
</head>
<body class="cinematic-bg">
    <!-- Снег -->
    <div class="snow-container" id="snow-container"></div>

    <div class="fixed top-0 w-full p-4 border-b border-white/10 bg-black/80 backdrop-blur-md z-50 flex justify-between items-center">
        <div class="flex items-center gap-3">
            <div>
                <h1 class="text-orange-500 font-bold tracking-widest text-xs">АРТЕФАКТ #402</h1>
                <p class="text-[9px] text-gray-500 uppercase">Связь: 31 дек 2024</p>
            </div>
        </div>
        <div class="flex items-center gap-4">
            <button id="mute-btn" onclick="toggleMute()" class="p-2 text-gray-400 hover:text-white transition-colors">
                <svg id="mute-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
                </svg>
            </button>
            <div class="text-right">
                <span id="year-display" class="text-lg font-bold text-white transition-all">2024</span>
            </div>
        </div>
    </div>

    <main id="chat-window" class="flex-1 mt-20 mb-28 px-4 py-6 overflow-y-auto w-full max-w-2xl mx-auto flex flex-col relative z-10">
        <div id="story-container" class="flex flex-col">
            <!-- Сообщения -->
        </div>
        <div id="typing-indicator" class="typing px-4">
            <span id="typing-name"></span> печатает<span class="dot"></span><span class="dot"></span><span class="dot"></span>
        </div>
    </main>

    <footer class="fixed bottom-0 w-full p-4 bg-gradient-to-t from-black via-black to-transparent z-40">
        <div class="max-w-2xl mx-auto">
            <button id="next-btn" onclick="processNext()" class="w-full py-4 bg-orange-800 hover:bg-orange-700 text-white rounded-lg tracking-widest uppercase text-[10px] font-bold transition-all shadow-2xl border border-orange-600/30">
                Продолжить чтение
            </button>
        </div>
    </footer>

    <script>
        // Аудио ресурсы
        const sounds = {
            click: new Audio('https://assets.mixkit.co/active_storage/sfx/2358/2358-preview.mp3'),
            glitch: new Audio('https://freesound.org/data/previews/458/458421_9381666-lq.mp3'),
            system: new Audio('https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3')
        };
        
        sounds.click.volume = 0.2;
        sounds.glitch.volume = 0.4;
        sounds.system.volume = 0.3;

        let isMuted = false;

        function toggleMute() {
            isMuted = !isMuted;
            const icon = document.getElementById('mute-icon');
            if (isMuted) {
                icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636" />';
            } else {
                icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />';
            }
        }

        function playSound(name) {
            if (!isMuted && sounds[name]) {
                sounds[name].currentTime = 0;
                sounds[name].play().catch(e => console.log("Audio play blocked"));
            }
        }

        function createSnow() {
            const container = document.getElementById('snow-container');
            const count = 50;
            for (let i = 0; i < count; i++) {
                const flake = document.createElement('div');
                flake.className = 'snowflake';
                const size = Math.random() * 3 + 1 + 'px';
                flake.style.width = size;
                flake.style.height = size;
                flake.style.left = Math.random() * 100 + 'vw';
                flake.style.animationDuration = Math.random() * 5 + 5 + 's';
                flake.style.animationDelay = Math.random() * 5 + 's';
                container.appendChild(flake);
            }
        }

        const story = [
            { type: 'system', text: "Прошел ровно год с того дня. Артем сидит в пустой квартире. 31 декабря 2024 года. 21:00." },
            { type: 'msg', side: 'left', name: 'Катя', time: '21:02', text: "Тём, ты где? Я уже у кинотеатра. Ты же не забыл? Наш сеанс в 22:00!" },
            { type: 'msg', side: 'right', name: 'Артем', time: '21:03', text: "Слушай, кто бы ты ни был — это не смешно. Хватит взламывать её аккаунт. Кати нет уже год." },
            { type: 'msg', side: 'left', name: 'Катя', time: '21:04', text: "В смысле нет? Я тут! У центрального входа. Блин, тут так странно... людей почти нет и огни какие-то тусклые. И снег... он как будто серый." },
            { type: 'msg', side: 'right', name: 'Артем', time: '21:05', text: "Прекрати. Она погибла 31 декабря 2023-го. По дороге в этот чертов кинотеатр. Я сейчас сижу и смотрю на её фото." },
            { type: 'msg', side: 'left', name: 'Катя', time: '21:06', text: "Тём... мне страшно. Я зашла внутрь, а тут в подъезде к залам вообще нет света. И на кассе никого. Но у меня в руках билеты. Посмотри, я пришлю фото." },
            { type: 'system', text: "*Приходит изображение. На нем старый, помятый билет. Дата: 31.12.2023. Время: 22:00. Но палец, держащий билет, кажется полупрозрачным.*" },
            { type: 'msg', side: 'right', name: 'Артем', time: '21:08', text: "Это фото из прошлого года. Зачем ты это делаешь со мной?" },
            { type: 'msg', side: 'left', name: 'Катя', time: '21:09', text: "Я не делаю! Я слышу твой голос, но ты как будто очень далеко. Тём, тут в коридоре кто-то стоит. Он высокий и у него нет лица. Он просто смотрит. ПОЖАЛУЙСТА, ПРИДИ ЗА МНОЙ." },
            { type: 'system', text: "*Артем вскакивает. В его 2024-м году в квартире внезапно гаснет свет. В тишине он слышит из своего телефона тихий шепот Кати: 'Тут так холодно...'*", glitch: true },
            { type: 'msg', side: 'right', name: 'Артем', time: '21:12', text: "Катя? Я иду. Я бегу к кинотеатру. Слышишь? Не уходи оттуда!" },
            { type: 'msg', side: 'left', name: 'Катя', time: '21:13', text: "Тут нет выхода. Все двери ведут обратно в этот темный холл. И часы... они показывают 21:59 и не двигаются дальше. Я в ловушке, да?" },
            { type: 'system', text: "*Артем добежал до кинотеатра. Здание заброшено и заколочено после пожара 2023 года. Но когда он прикладывает ухо к разбитому стеклу, он слышит звук работающего проектора изнутри.*" },
            { type: 'msg', side: 'right', name: 'Артем', time: '21:20', text: "Катя, я снаружи. Здесь всё заколочено. Кинотеатра больше нет, он сгорел в ту ночь! Но я слышу звук... звук старой плёнки. Ты меня слышишь через стекло?" },
            { type: 'msg', side: 'left', name: 'Катя', time: '21:22', text: "Я слышу стук! Но ты стучишь не по стеклу... ты как будто стучишь прямо в моей голове. Тём, человек без лица подходит ближе. Он пахнет гарью. Пожалуйста, сделай что-нибудь!" },
            { type: 'msg', side: 'right', name: 'Артем', time: '21:24', text: "Катя, слушай меня! На билете... на твоем билете есть номер места. Какое там место? Я попробую найти его в зале, я сейчас ломаю доски на входе!" },
            { type: 'msg', side: 'left', name: 'Катя', time: '21:25', text: "Место 13... Ряд 7. Но тут нет кресел, Тём. Тут только пепел и тени. О боже, он положил руку мне на плечо. Она ледяная..." },
            { type: 'system', text: "*Артем врывается в обугленный зал. В 2024 году это лишь груда мусора. Но на месте 13 ряда 7 он видит слабый, призрачный свет телефона, парящий в воздухе.*", glitch: true },
            { type: 'msg', side: 'right', name: 'Артем', time: '21:28', text: "Я ВИЖУ ТВОЙ СВЕТ! КАТЯ! ХВАТАЙСЯ ЗА МОЮ РУКУ! Я ТЯНУ ЕЁ К ТЕБЕ!" },
            { type: 'msg', side: 'left', name: 'Катя', time: '21:30', text: "Я вижу... я вижу руку из чистого света. Я пытаюсь... но он не пускает! Он говорит, что моё время вышло. Артем, прощай... Помни меня." },
            { type: 'system', text: "*Свет телефона гаснет. Звук проектора сменяется мертвой тишиной. На ладони Артема остается лишь копоть и старая заколка, которую Катя носила в тот вечер.*" },
            { type: 'system', text: "Связь прервана. Объект синхронизации потерян. С Новым годом, Артем." }
        ];

        let index = 0;
        let isTyping = false;
        const container = document.getElementById('story-container');
        const typingIndicator = document.getElementById('typing-indicator');
        const typingName = document.getElementById('typing-name');
        const nextBtn = document.getElementById('next-btn');
        const yearDisplay = document.getElementById('year-display');
        const chatWindow = document.getElementById('chat-window');

        function scrollToBottom() {
            setTimeout(() => {
                chatWindow.scrollTo({
                    top: chatWindow.scrollHeight,
                    behavior: 'smooth'
                });
            }, 100);
        }

        async function processNext() {
            if (index >= story.length || isTyping) return;

            const item = story[index];
            nextBtn.disabled = true;
            nextBtn.style.opacity = "0.5";

            if (item.type === 'msg') {
                isTyping = true;
                typingName.innerText = item.name;
                typingIndicator.style.display = 'block';
                playSound('click');
                scrollToBottom();

                await new Promise(resolve => setTimeout(resolve, 1500));
                
                typingIndicator.style.display = 'none';
                isTyping = false;
                renderMessage(item);
            } else {
                renderSystem(item);
            }

            index++;
            nextBtn.disabled = false;
            nextBtn.style.opacity = "1";

            if (index >= story.length) {
                nextBtn.innerText = "ФИНАЛ ИСТОРИИ";
                nextBtn.disabled = true;
                nextBtn.style.backgroundColor = "#222";
            }
        }

        function renderMessage(item) {
            const div = document.createElement('div');
            div.className = `message flex flex-col ${item.side === 'right' ? 'self-end items-end' : 'self-start items-start'}`;
            
            div.innerHTML = `
                <div class="bubble shadow-xl">
                    <p>${item.text}</p>
                </div>
                <span class="text-[9px] mt-1 text-gray-500 px-1 uppercase">${item.name} • ${item.time}</span>
            `;

            container.appendChild(div);
            setTimeout(() => div.classList.add('show'), 10);
            
            if (item.side === 'left') {
                yearDisplay.innerText = "2023?";
                yearDisplay.style.color = "#ef4444";
            } else {
                yearDisplay.innerText = "2024";
                yearDisplay.style.color = "#ffffff";
            }

            scrollToBottom();
        }

        function renderSystem(item) {
            const div = document.createElement('div');
            div.className = `system-msg ${item.glitch ? 'glitch-text' : ''}`;
            div.innerHTML = item.text;

            if (item.glitch) {
                document.body.classList.add('global-glitch');
                playSound('glitch');
                setTimeout(() => {
                    document.body.classList.remove('global-glitch');
                }, 3000);
            } else {
                playSound('system');
            }

            container.appendChild(div);
            setTimeout(() => div.style.opacity = "1", 10);
            scrollToBottom();
        }

        window.onload = () => {
            createSnow();
            processNext();
        };
    </script>
</body>
</html>

