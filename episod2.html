<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Последний сеанс - Эпизод 2: Заколка</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
body {
    font-family: 'Roboto', sans-serif;
    background-color: #050505;
    color: #d1d1d1;
    overflow-x: hidden;
    scroll-behavior: smooth;
    transition: background-color 0.5s;
}
.cinematic-bg {
    background: radial-gradient(circle at center, #1a1a2e 0%, #050505 100%);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    position: relative;
}
.snow-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 1;
}
.snowflake {
    position: absolute;
    background: white;
    border-radius: 50%;
    opacity: 0.2;
    animation: fall linear infinite;
}
@keyframes fall {
    to { transform: translateY(100vh) translateX(20px); }
}
.message {
    max-width: 85%;
    margin-bottom: 1.5rem;
    opacity: 0;
    transform: translateY(10px);
    transition: all 0.4s ease-out;
    z-index: 10;
}
.message.show { opacity:1; transform: translateY(0); }
.bubble {
    padding: 12px 16px;
    border-radius: 18px;
    position: relative;
    font-size: 0.95rem;
    line-height: 1.4;
    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
}
.msg-left .bubble {
    background: #1f1f27;
    border: 1px solid #333;
    border-bottom-left-radius: 4px;
    color: #e0e0e0;
}
.msg-right .bubble {
    background: #431407;
    border-bottom-right-radius: 4px;
    color: #ffffff;
}
.msg-observer .bubble {
    background: #000;
    border: 1px solid #00ff00;
    font-family: 'JetBrains Mono', monospace;
    color: #00ff00;
    border-radius: 0;
    text-transform: uppercase;
    font-size: 0.8rem;
}
.typing {
    font-size: 0.8rem;
    color: #6b7280;
    margin-bottom: 1rem;
    display: none;
    font-style: italic;
}
.system-msg {
    font-style: italic;
    color: #6b7280;
    text-align: center;
    font-size: 0.85rem;
    margin: 2rem 0;
    padding: 0 2rem;
    line-height: 1.5;
    transition: all 0.3s;
}
.global-glitch {
    animation: screen-shake 0.3s infinite;
    filter: contrast(150%) brightness(120%) saturate(200%);
}
@keyframes screen-shake {
    0% { transform: translate(0,0); }
    20% { transform: translate(-5px, 5px) skewX(2deg); }
    40% { transform: translate(5px, -5px) rotate(1deg); }
    60% { transform: translate(-5px, -5px) skewY(2deg); }
    80% { transform: translate(5px, 5px) scale(1.02); }
    100% { transform: translate(0,0); }
}
.artifact-glow {
    box-shadow: 0 0 40px #f87171 !important;
    border: 1px solid #f87171 !important;
}
.dot {
    display: inline-block;
    width: 4px;
    height: 4px;
    background: #6b7280;
    border-radius: 50%;
    margin-right: 2px;
    animation: dot-pulse 1.4s infinite;
}
.dot:nth-child(2) { animation-delay: 0.2s; }
.dot:nth-child(3) { animation-delay: 0.4s; }
@keyframes dot-pulse {
    0%,100%{opacity:0.3;transform:translateY(0);}
    50%{opacity:1;transform:translateY(-3px);}
}
</style>
</head>
<body class="cinematic-bg">
<div class="snow-container" id="snow-container"></div>

<div class="fixed top-0 w-full p-4 border-b border-white/10 bg-black/80 backdrop-blur-md z-50 flex justify-between items-center">
    <div>
        <h1 id="episode-title" class="text-orange-500 font-bold tracking-widest text-xs uppercase">Эпизод 2: Заколка</h1>
        <p id="sub-title" class="text-[9px] text-gray-500 uppercase">Март 2025</p>
    </div>
    <div class="flex items-center gap-4">
        <button id="mute-btn" onclick="toggleMute()" class="p-2 text-gray-400 hover:text-white transition-colors">
            <svg id="mute-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"/>
            </svg>
        </button>
        <span id="year-display" class="text-lg font-bold text-white transition-all">2025</span>
    </div>
</div>

<main id="chat-window" class="flex-1 mt-20 mb-28 px-4 py-6 overflow-y-auto w-full max-w-2xl mx-auto flex flex-col relative z-10">
    <div id="story-container" class="flex flex-col"></div>
    <div id="typing-indicator" class="typing px-4">
        <span id="typing-name"></span> печатает<span class="dot"></span><span class="dot"></span><span class="dot"></span>
    </div>
</main>

<footer class="fixed bottom-0 w-full p-4 bg-gradient-to-t from-black via-black to-transparent z-40">
    <div class="max-w-2xl mx-auto">
        <button id="next-btn" onclick="processNext()" class="w-full py-4 bg-orange-800 hover:bg-orange-700 text-white rounded-lg tracking-widest uppercase text-[10px] font-bold transition-all shadow-2xl border border-orange-600/30">
            Продолжить
        </button>
    </div>
</footer>

<script>
const sounds = {
    click: new Audio('https://assets.mixkit.co/active_storage/sfx/2358/2358-preview.mp3'),
    glitch: new Audio('https://freesound.org/data/previews/458/458421_9381666-lq.mp3'),
    system: new Audio('https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3'),
    whisper: new Audio('https://freesound.org/data/previews/346/346124_4516335-lq.mp3')
};
sounds.click.volume = 0.2; sounds.glitch.volume = 0.4; sounds.system.volume = 0.3; sounds.whisper.volume = 0.5;

let isMuted=false, index=0, isTyping=false;

const story=[
    {type:'system', text:"Прошло несколько месяцев. Весна 2025. Артем не может забыть. Заколка всегда с ним."},
    {type:'msg', side:'right', name:'Артем', time:'02:00', text:"Я ношу её с собой постоянно. Она как память, но… ощущение, что она живая."},
    {type:'system', text:"Иногда в отражении он замечает силуэт Кати, но когда оборачивается — пустая комната."},
    {type:'msg', side:'right', name:'Артем', time:'02:10', text:"Она… появляется в зеркале. Я её вижу на мгновение…"} ,
    {type:'system', text:"В старом чате появляется новое сообщение от неизвестного пользователя Observer_402."},
    {type:'msg', side:'observer', name:'Observer_402', time:'??:??', text:"ТЫ ВЗЯЛ ТО, ЧТО НЕ ПРИНАДЛЕЖИТ ТВОЕМУ ВРЕМЕНИ."},
    {type:'msg', side:'right', name:'Артем', time:'02:16', text:"Кто ты? Откуда ты знаешь?"},
    {type:'msg', side:'observer', name:'Observer_402', time:'??:??', text:"АРТЕФАКТ ДОЛЖЕН БЫТЬ ВЕРНУТ. ОНА НЕ МЕРТВА И НЕ ЖИВА. ОНА МЕЖДУ. ТЫ ДЕРЖИШЬ ЕЁ ЗА ЯКОРЬ, КОТОРЫЙ РАЗРЫВАЕТ ЕЁ ДУШУ."},
    {type:'system', text:"Артем находит в интернете закрытый форум. Люди описывают забытые предметы, которые «живут» между временными линиями."},
    {type:'msg', side:'right', name:'Артем', time:'03:40', text:"Если я верну заколку… она вернется? Или исчезнет навсегда?"},
    {type:'system', text:"Ночью заколка начинает пульсировать багровым светом.", glow:true},
    {type:'system', text:"Из предмета доносится слабый шепот…", glitch:true, whisper:true},
    {type:'msg', side:'left', name:'Катя (Шепот)', time:'??:??', text:"Артём… верни… верни меня… тут… так… темно…"},
    {type:'system', text:"Артем понимает: вернуть заколку — значит потерять Катю второй раз. Но Observer_402 предупреждал: её время не принадлежит его линии."},
    {type:'system', text:"Конец Эпизода 2. Подготовка к Эпизоду 3…"}
];

function toggleMute(){
    isMuted=!isMuted;
    const icon=document.getElementById('mute-icon');
    icon.innerHTML=isMuted?
        '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"/>':
        '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"/>';
}

function playSound(name){
    if(!isMuted && sounds[name]){
        sounds[name].currentTime=0;
        sounds[name].play().catch(()=>{});
    }
}

function createSnow(){
    const container=document.getElementById('snow-container');
    for(let i=0;i<50;i++){
        const flake=document.createElement('div');
        flake.className='snowflake';
        const size=Math.random()*3+1+'px';
        flake.style.width=size; flake.style.height=size;
        flake.style.left=Math.random()*100+'vw';
        flake.style.animationDuration=Math.random()*5+5+'s';
        flake.style.animationDelay=Math.random()*5+'s';
        container.appendChild(flake);
    }
}

async function processNext(){
    if(index>=story.length || isTyping) return;
    const item=story[index];
    const nextBtn=document.getElementById('next-btn');
    nextBtn.disabled=true; nextBtn.style.opacity="0.5";

    if(item.type==='msg'){
        isTyping=true;
        const typingName=document.getElementById('typing-name');
        const typingIndicator=document.getElementById('typing-indicator');
        typingName.innerText=item.name;
        typingIndicator.style.display='block';
        playSound('click');
        scrollToBottom();
        await new Promise(r=>setTimeout(r,1600));
        typingIndicator.style.display='none';
        isTyping=false;
        renderMessage(item);
    }else{
        renderSystem(item);
    }
    index++;
    nextBtn.disabled=false; nextBtn.style.opacity="1";
    nextBtn.innerText="Читать дальше";
    if(index>=story.length){nextBtn.innerText="КОНЕЦ ЭПИЗОДА 2"; nextBtn.disabled=true;}
}

function renderMessage(item){
    const container=document.getElementById('story-container');
    const div=document.createElement('div');
    let sideClass="self-start items-start msg-left";
    if(item.side==='right') sideClass="self-end items-end msg-right";
    if(item.side==='observer') sideClass="self-center items-center msg-observer";
    div.className=`message flex flex-col ${sideClass}`;
    div.innerHTML=`<div class="bubble shadow-xl"><p>${item.text}</p></div>
        <span class="text-[9px] mt-1 text-gray-500 px-1 uppercase">${item.name} • ${item.time}</span>`;
    container.appendChild(div);
    setTimeout(()=>div.classList.add('show'),10);
    scrollToBottom();
}

function renderSystem(item){
    if(item.episode){
        document.getElementById('episode-title').innerText=item.episode;
        document.getElementById('sub-title').innerText=item.sub;
        document.getElementById('year-display').innerText=item.year;
    }
    const container=document.getElementById('story-container');
    const div=document.createElement('div');
    div.className=`system-msg ${item.glitch?'glitch-text':''} ${item.glow?'artifact-glow p-4 rounded-lg':''}`;
    div.innerHTML=item.text;
    if(item.glitch){document.body.classList.add('global-glitch'); playSound('glitch'); setTimeout(()=>document.body.classList.remove('global-glitch'),2000);}
    else if(item.whisper){playSound('whisper');}
    else{playSound('system');}
    container.appendChild(div);
    setTimeout(()=>div.style.opacity="1",10);
    scrollToBottom();
}

function scrollToBottom(){
    const chatWindow=document.getElementById('chat-window');
    setTimeout(()=>{chatWindow.scrollTo({top:chatWindow.scrollHeight,behavior:'smooth'});},50);
}

window.onload=()=>{createSnow(); processNext();};
</script>
</body>
</html>